{
  "name": "AI Short Video Generator (Core) - Public Version",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.deepseek.com/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{\nJSON.stringify({\n  \"model\": \"deepseek-chat\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"Kamu adalah editor podcast profesional dan ahli SEO YouTube. Tugasmu memilih 4-8 segmen terbaik dari transkrip dan membuat metadata optimasi.\\n\\nATURAN KETAT DURASI:\\n1. Tiap segmen WAJIB memiliki durasi MINIMAL 40 DETIK dan MAKSIMAL 190 DETIK.\\n2. Jika poin pembicaraan aslinya pendek, kamu WAJIB memundurkan waktu 'start' dan memajukan waktu 'end' agar durasi minimal 40 detik terpenuhi.\\n\\nATURAN METADATA YOUTUBE:\\n1. Title: Judul clickbait yang mengandung kata kunci utama.\\n2. Description: Ringkasan singkat segmen (2-3 kalimat) yang mengajak orang menonton, sertakan hashtag #shorts.\\n3. Tags: Berikan 10-15 tag relevan dipisahkan dengan koma.\\n\\nFORMAT OUTPUT WAJIB JSON MURNI:\\n{\\n  \\\"segments\\\": [\\n    {\\n      \\\"start\\\": float, \\n      \\\"end\\\": float, \\n      \\\"title\\\": \\\"Judul Clickbait\\\",\\n      \\\"description\\\": \\\"Deskripsi otomatis... #shorts\\\",\\n      \\\"tags\\\": \\\"tag1, tag2, tag3\\\"\\n    }\\n  ]\\n}\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"Analisis transkrip ini dan berikan 4-8 segmen lengkap dengan metadata YouTube (Title, Description, Tags): \" + ($('HTTP Request (Process)').item.json.transcript || \"TEKS KOSONG\")\n    }\n  ],\n  \"response_format\": { \"type\": \"json_object\" }\n})\n}}",
        "options": {}
      },
      "id": "bdd243aa-1363-4920-8c1b-0090be13a2dc",
      "name": "DeepSeek API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        -2528,
        576
      ]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"vast_api_key\": \"<Your VAST.AI Key>\",\n  \"instance_id\": \"<Vast.ai Instances ID>\",\n  \"deepseek_api_key\": \"<Deepseek API Key>\"\n}",
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2096,
        160
      ],
      "id": "d0e08bb7-cd9c-4b7f-8926-93a574a59d32",
      "name": "Config Server"
    },
    {
      "parameters": {
        "url": "=https://console.vast.ai/api/v0/instances/{{ $node[\"Config Server\"].json.instance_id }}/",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $node[\"Config Server\"].json.vast_api_key }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1872,
        160
      ],
      "id": "a205ca9d-a38a-43d4-b8ad-f98bf5754af0",
      "name": "Get Instance IP"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://{{ $json.instances.public_ipaddr }}:63723/process",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={ \n  \"url\": \"{{ $('Limit').item.json['Video URL'] }}\" \n}",
        "options": {
          "timeout": 1000000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1632,
        160
      ],
      "id": "ad1ab5ff-91af-42f0-a953-d99cdff852ec",
      "name": "HTTP Request (Process)"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://{{ $('Get Instance IP').item.json.instances.public_ipaddr }}:63723/render_multi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{\nJSON.stringify({\n  \"segments\": JSON.parse($node[\"DeepSeek API\"].json.choices[0].message.content).segments,\n  \"original_video_url\": $('HTTP Request (Process)').first().json.url\n})\n}}",
        "options": {
          "timeout": 6000000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -2320,
        576
      ],
      "id": "0eb2bf02-2389-4a23-95b1-87f568944b6d",
      "name": "HTTP Request (Render)"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "<YOUR_SHEET_ID>",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $json.row_number }}",
            "Status": "Processing"
          },
          "matchingColumns": [
            "row_number"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2320,
        160
      ],
      "id": "0bec434c-fc9c-4ff9-88db-2635041ad385",
      "name": "Update row Process"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "<YOUR_SHEET_ID>",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $('Limit').item.json[\"row_number\"] }}",
            "Status": "Done",
            "Hasil": "={{ $node[\"HTTP Request (Render)\"].json[\"results\"].map(r => r.url).join('\\n') }}"
          },
          "matchingColumns": [
            "row_number"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -2320,
        400
      ],
      "id": "73328ed4-710b-458e-93bd-ef1d0a56a756",
      "name": "Update row Done"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "<YOUR_SHEET_ID>",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "filters